# Dockerfile.demucs

# Usa la imagen oficial PyTorch con la versi√≥n 2.0.0 y CUDA 11.8
FROM pytorch/pytorch:2.0.0-cuda11.7-cudnn8-devel

# Instalar paquetes extras (ffmpeg, imagemagick...)
RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg git imagemagick \
    libpangocairo-1.0-0 \
    libpangoft2-1.0-0 \
    libmagickwand-dev \
 && rm -rf /var/lib/apt/lists/*

# Parchear policy.xml de ImageMagick (si lo necesitas)
RUN sed -i 's|<policy domain="path" rights="none" pattern="@\*"/>|<!-- <policy domain="path" rights="none" pattern="@*"/> -->|' /etc/ImageMagick-6/policy.xml || true

# Carpeta de trabajo
WORKDIR /KaraokeProject

# Copiar e instalar requirements A
COPY requirementsA.txt /KaraokeProject
RUN pip install --no-cache-dir -r requirementsA.txt

# Copiar tu proyecto (app.py, main.py, etc.)
COPY . /KaraokeProject

EXPOSE 5000
CMD ["python", "app.py"]